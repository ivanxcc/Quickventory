#you will need to change some of the information depending on what you name you Excel workbook and where you save it
import openpyxl

# extract data from QR code
def extract_data_from_qr(qr_text):
    # QR codes encode data with a comma seperating elements
    return qr_text.split(',')

#write data to Excel file
def write_to_excel(data, excel_file_path):
    try:
        workbook = openpyxl.load_workbook(excel_file_path)

        # Extract the key number from the data (assuming it's the first element)
        key_number = data[0]

        # Choose the sheet based on the key prefix
        if key_number.startswith('H'):
            sheet_name = 'Here'
        elif key_number.startswith('T'):
            sheet_name = 'There'
        else:
            sheet_name = 'Other'

        # Select the sheet
        if sheet_name not in workbook.sheetnames:
            workbook.create_sheet(title=sheet_name)

        sheet = workbook[sheet_name]

        # next available row
        next_row = None
        for row_num, row in enumerate(sheet.iter_rows(min_row=1, max_row=sheet.max_row, values_only=True), start=1):
            if all(cell is None for cell in row):
                next_row = row_num
                break

        if next_row is None:
            next_row = sheet.max_row + 1

        # Overwrites already existing data
        for col_num, value in enumerate(data, start=1):
            sheet.cell(row=next_row, column=col_num, value=value)

        # Save workbook
        workbook.save(excel_file_path)

        print(f"Data written to Excel sheet '{sheet_name}' at row {next_row}")

    except Exception as e:
        print(f"Error writing to Excel: {e}")

# Simulate scanning QR code
def simulate_qr_code_scan(qr_code_data):
    return qr_code_data

#example 
input_excel_file_path = 'path_to_input_excel_file.xlsx'
output_excel_file_path = 'output_data.xlsx'

# Simulate scanning a QR code
scanned_qr_data = simulate_qr_code_scan("Here,is,an,example")  

#Extract data 
extracted_data = extract_data_from_qr(scanned_qr_data)

# Write 
write_to_excel(extracted_data, output_excel_file_path)
